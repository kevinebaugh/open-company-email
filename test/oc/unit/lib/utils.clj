(ns oc.unit.lib.utils
  (:require [clojure.test :refer [deftest testing is]]
            [oc.lib.utils :as utils]))

(deftest test-utils

  (testing "truncate decimals function"
    (is (= "1"     (utils/truncate-decimals 1 2)))
    (is (= "1"     (utils/truncate-decimals 1.0 1)))
    (is (= "1"     (utils/truncate-decimals 1.0 2)))
    (is (= "1"     (utils/truncate-decimals 1.00 1)))
    (is (= "1"     (utils/truncate-decimals 1.01 1)))
    (is (= "1"     (utils/truncate-decimals 1.049 1)))
    (is (= "1"     (utils/truncate-decimals 1.00 2)))
    (is (= "1"     (utils/truncate-decimals 1.001 2)))
    (is (= "1"     (utils/truncate-decimals 1.0049 2)))
    (is (= "1"     (utils/truncate-decimals 1.001 2)))
    (is (= "1"     (utils/truncate-decimals 1.004 2)))
    (is (= "1.01"  (utils/truncate-decimals 1.01 2)))
    ; next one fails because (* 100 1.005) =  100.49999999999999, ugh
    ;(is (= "1.01"  (utils/truncate-decimals 1.005 2)))
    (is (= "1.1"   (utils/truncate-decimals 1.1 1)))
    (is (= "1.1"   (utils/truncate-decimals 1.10 2)))
    (is (= "1.1"   (utils/truncate-decimals 1.104 2)))
    (is (= "1.2"   (utils/truncate-decimals 1.15 1)))
    (is (= "3.14"   (utils/truncate-decimals Math/PI 2)))
    (is (= "3.1"   (utils/truncate-decimals Math/PI 1))))

  (testing "with size label function"
    (is (= "1"     (utils/with-size-label 1.00123456)))
    (is (= "1.2"   (utils/with-size-label 1.20123456)))
    (is (= "1.23"  (utils/with-size-label 1.23456789)))
    (is (= "10"    (utils/with-size-label 10.0123456)))
    (is (= "10.2"  (utils/with-size-label 10.2345678)))
    (is (= "100"   (utils/with-size-label 100.000000)))
    (is (= "100"   (utils/with-size-label 100.123456)))
    (is (= "1K"    (utils/with-size-label 1000.12345)))
    (is (= "1.2K"  (utils/with-size-label 1200.12345)))
    (is (= "1.23K" (utils/with-size-label 1230.12345)))
    (is (= "10K"   (utils/with-size-label 10000.3456)))
    (is (= "10.1K" (utils/with-size-label 10120.3456)))
    (is (= "1M"    (utils/with-size-label 1000000.12)))
    (is (= "1.2M"  (utils/with-size-label 1200000.12)))
    (is (= "1.23M" (utils/with-size-label 1230000.12)))
    (is (= "10M"   (utils/with-size-label 10000000.1)))
    (is (= "10.1M" (utils/with-size-label 10123456.7)))
    (is (= "100M"  (utils/with-size-label 100123456)))
    (is (= "650K"  (utils/with-size-label 650478)))
    (is (= "2.55M"  (utils/with-size-label 2546589)))
    (is (= "-1"     (utils/with-size-label -1.00123456)))
    (is (= "-1.2"   (utils/with-size-label -1.20123456)))
    (is (= "-1.23"  (utils/with-size-label -1.23456789)))
    (is (= "-10"    (utils/with-size-label -10.0123456)))
    (is (= "-10.2"  (utils/with-size-label -10.2345678)))
    (is (= "-100"   (utils/with-size-label -100.000000)))
    (is (= "-100"   (utils/with-size-label -100.123456)))
    (is (= "-1K"    (utils/with-size-label -1000.12345)))
    (is (= "-1.2K"  (utils/with-size-label -1200.12345)))
    (is (= "-1.23K" (utils/with-size-label -1230.12345)))
    (is (= "-10K"   (utils/with-size-label -10000.3456)))
    (is (= "-10.1K" (utils/with-size-label -10120.3456)))
    (is (= "-1M"    (utils/with-size-label -1000000.12)))
    (is (= "-1.2M"  (utils/with-size-label -1200000.12)))
    (is (= "-1.23M" (utils/with-size-label -1230000.12)))
    (is (= "-10M"   (utils/with-size-label -10000000.1)))
    (is (= "-10.1M" (utils/with-size-label -10123456.7)))
    (is (= "-100M"  (utils/with-size-label -100123456)))
    (is (= "-650K"  (utils/with-size-label -650478)))
    (is (= "-2.55M"  (utils/with-size-label -2546589)))))